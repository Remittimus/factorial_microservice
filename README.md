# Rest factorial
## ТЗ  
Разработать микросервис, который удовлетворяет следующим условиям:
1) Принимает на вход по HTTP json:
  {“factorial_num” :  5}

2) Вычисляет факториал числа, полученного в body

3) Возвращает рассчитанное значение в json формате:
 {“result” : 120 }

4) Обработка технических и бизнес-ошибок (например, чтобы пользователь не отправлял запросы на расчет факториала чисел более 100 и т.п.) должна присутствовать.

5) Сервис должен предоставлять технические метрики в формете Prometheus и health по HTTP. Можно придумать свои бизнес метрики (например, время расчета факториала). 

6) Сборщик проекта: maven или gradle

7) Также необходимо подключить к проекту систему контроля версий Git.

8) Предусмотреть упаковку сборки в Docker.

9) Написать unit и интеграционные тесты.
## Технический стек  
- Java 17
- Spring Boot 3.2.4
## Примечания
- Поскольку в тз говорится о лимите значений до 100, я не вижу смысла высчитывать каждый запрос факториала заново, если это можно сделать это заранее, а после отдавать пользователям ответы. В данном решении факториалы высчитываются во время запуска приложения.
- С другой стороны я предусмотрел возможное расширение лимита и сделал размер кэша (иначе говоря количество хранимых факториалов) конфигурируемым через properties/yml. Разумеется, данное решение малоактуально для больших размеров кэша, но имеет право на жизнь, когда числа из пользовательских запросов лежат в конкретном небольшом промежутке.
- Валидацией (я использовал @Valid от jakarta) пропускаются только целые числа в промежутке от 0 до максимального размера кэша. Для корректных details в ответах с 400 я написал свой небольшой валидатор и аннотацию, которую указываю над полем для валидации.
Поскольку факториалы в программе высчитываются факториалы только для целых чисел, округлять значения, в случае если пользователь пришлет дробь, я посчитал недопустимым, поэтому изначально запрос маппится к стрингу, а после проходит валидацию. Если закрыть глаза на округление, то можно было обойтись и @Min @Max @NoNull из коробки.
- Две кастомные метрики через @Timed (создаются при первом вызове соотвествующих методов в @ControllerAdvice классе):
  - validation_failed - количество (и немного бессмысленное время обработки метода) для запросов проваливших верификацию
  - invalid_factorial_value - аналогично, но для запросов, которые прошли верификацию, но некорректны с точки зрения размера кэша. По-хорошему никогда не должна всплывать в прометеусе.
## Build  
В pom.xml плагин на билд сразу в докер образ
```bash
mvn clean install spring-boot:build-image
```
Быстрый старт с имеющимся image:
```bash
docker-compose -f .\docker-compose.yml up
```
